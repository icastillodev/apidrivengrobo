<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil - GROBO</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../dist/style/css/tailwind.css">

    <style>
        body { font-family: 'Lato', sans-serif; background-color: #f4f7f6; }
        .form-control:focus { border-color: #1a5d3b; box-shadow: 0 0 0 0.25rem rgba(26, 93, 59, 0.25); }
    </style>

<script type="module">
    import { Auth } from '../../dist/js/auth.js';
    import { API } from '../../dist/js/api.js';
    import { initMenu } from '../../dist/js/components/MenuComponent.js';
    import { showLoader, hideLoader } from '../../dist/js/components/LoaderComponent.js';
    import { NotificationManager } from '../../dist/js/NotificationManager.js';
    import { checkUrlParamsAndOpen } from '../../dist/js/components/UrlRouter.js';
    import { loadLanguage } from '../../dist/js/utils/i18n.js';
    import { initProfile } from '../../dist/js/pages/usuario/perfil.js';

    document.addEventListener('DOMContentLoaded', async () => {
        showLoader();

        try {
            // 1. CARGA CRÍTICA: Idioma
            // Bloqueamos hasta que window.txt esté listo para las etiquetas del perfil
            await loadLanguage(); 

            // 2. VALIDACIÓN DE ACCESO (Niveles 1, 2, 3)
            Auth.checkAccess([1, 2, 3 , 4, , 5 , 6]); 

            // 3. INICIALIZACIÓN DE COMPONENTES
            if (window.txt) {
                initMenu();
                NotificationManager.init();
                
                // Inicialización de la lógica del Perfil (Carga de datos del usuario, etc.)
                initProfile();
                
                console.log("✅ Página de Perfil inicializada.");
            } else {
                throw new Error("El objeto de idioma window.txt no se generó.");
            }

            // 4. ROUTER (Delay de estabilidad para abrir tabs específicas si vienen por URL)
            setTimeout(() => {
                checkUrlParamsAndOpen();
            }, 300);

        } catch (error) {
            console.error("❌ Fallo en inicialización de Perfil:", error);
        } finally {
            hideLoader();
        }
    });
</script>
</head>
<body class="bg-light">
    <div class="container my-5 px-4">
        
        <div class="d-flex align-items-center mb-4 border-bottom pb-3">
            <h4 class="fw-bold mb-0 text-dark text-uppercase">Mi Perfil</h4>
        </div>

        <div class="row g-4">
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm text-center h-100">
                    <div class="card-body p-5">
                        <div class="mb-4">
                            <div class="d-inline-flex align-items-center justify-content-center bg-light rounded-circle text-success" style="width: 100px; height: 100px;">
                                <i class="bi bi-person-fill" style="font-size: 3rem;"></i>
                            </div>
                        </div>
                        <h5 class="fw-bold mb-1" id="lbl-nombre-completo">Cargando...</h5>
                        <p class="text-muted small mb-3" id="lbl-usuario">@usuario</p>
                        <span class="badge bg-success bg-opacity-10 text-success border border-success px-3 py-2" id="lbl-institucion">...</span>
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white border-0 py-3">
                        <h6 class="fw-bold text-primary mb-0"><i class="bi bi-pencil-square me-2"></i>DATOS PERSONALES</h6>
                    </div>
                    <div class="card-body p-4">
                        <form id="form-personal">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-muted">Nombre</label>
                                    <input type="text" name="nombre" id="input-nombre" class="form-control fw-bold" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-muted">Apellido</label>
                                    <input type="text" name="apellido" id="input-apellido" class="form-control fw-bold" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-muted">Correo Electrónico</label>
                                    <input type="email" name="email" id="input-email" class="form-control" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-muted">Celular / Teléfono</label>
                                    <input type="text" name="celular" id="input-celular" class="form-control">
                                </div>
                                <div class="col-12 text-end mt-4">
                                    <button type="submit" class="btn btn-primary fw-bold shadow-sm px-4">GUARDAR CAMBIOS</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0 py-3">
                        <h6 class="fw-bold text-danger mb-0"><i class="bi bi-shield-lock me-2"></i>SEGURIDAD</h6>
                    </div>
                    <div class="card-body p-4">
                        <form id="form-security">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label small fw-bold text-muted">Contraseña Actual</label>
                                    <input type="password" id="pass-current" class="form-control" placeholder="Ingrese su contraseña actual para confirmar" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-muted">Nueva Contraseña</label>
                                    <input type="password" id="pass-new" class="form-control" placeholder="Mínimo 6 caracteres" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-muted">Confirmar Nueva</label>
                                    <input type="password" id="pass-confirm" class="form-control" placeholder="Repita la nueva contraseña" required>
                                </div>
                                <div class="col-12 text-end mt-4">
                                    <button type="submit" class="btn btn-outline-danger fw-bold shadow-sm px-4">ACTUALIZAR CONTRASEÑA</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>