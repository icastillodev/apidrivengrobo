<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GROBO - Panel de Investigador</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <link rel="stylesheet" href="/URBE-API-DRIVEN/front/dist/style/css/styles.css">
    <link rel="stylesheet" href="/URBE-API-DRIVEN/front/dist/style/css/tailwind.css">
</head>

<body class="bg-gray-50 font-sans">

    </main>

<script type="module">
    import { Auth } from '../../dist/js/auth.js';
    import { API } from '../../dist/js/api.js';
    import { initMenu } from '../../dist/js/components/MenuComponent.js';
    import { showLoader, hideLoader } from '../../dist/js/components/LoaderComponent.js';
    import { NotificationManager } from '../../dist/js/NotificationManager.js';
    import { checkUrlParamsAndOpen } from '../../dist/js/components/UrlRouter.js';
    import { loadLanguage } from '../../dist/js/utils/i18n.js';

    document.addEventListener('DOMContentLoaded', async () => {
        showLoader();

        try {
            // 1. CARGA CRÍTICA: Idioma
            // Detiene la ejecución hasta que window.txt esté disponible
            await loadLanguage(); 

            // 2. VALIDACIÓN DE ACCESO (Nivel 3)
            Auth.checkAccess([3]); 

            // 3. INICIALIZACIÓN DE COMPONENTES
            // Solo si el idioma cargó correctamente para evitar errores en el menú
            if (window.txt) {
                initMenu();
                NotificationManager.init();
            } else {
                throw new Error("El objeto de idioma window.txt no se generó correctamente.");
            }

            // 4. ROUTER (Delay de estabilidad para parámetros de URL)
            setTimeout(() => {
                checkUrlParamsAndOpen();
            }, 300);

        } catch (error) {
            console.error("❌ Fallo en inicialización del Dashboard:", error);
        } finally {
            hideLoader();
        }
    });
</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>