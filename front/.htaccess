Options -Indexes
RewriteEngine On

# ============================================================
# 1. FIX DE RUTAS PARA ASSETS
# Si pides algo de /dist/ pero vienes de un slug (ej: /sede1/dist/js/auth.js)
# esta regla quita el "sede1" de la ruta para que Apache encuentre el archivo real.
# ============================================================
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^.+/(dist|assets|paginas|resources)/(.*)$ $1/$2 [L]

# 2. EXCEPCIÓN PARA ARCHIVOS FÍSICOS
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# 3. REGLA FORMULARIO DE REGISTRO
RewriteRule ^formulario/([a-zA-Z0-9_-]+)/?$ paginas/formulario/index.html?inst=$1 [L,QSA]

# 4. REGLA LOGIN POR SEDE (Slug)
# Evita que las carpetas reales se confundan con nombres de instituciones
RewriteCond %{REQUEST_URI} !/(dist|paginas|assets|resources|node_modules)
RewriteRule ^([a-zA-Z0-9_-]+)/?$ index.html?inst=$1 [L,QSA]

# 5. CATCH-ALL PARA ERRORES (Solo si no es un asset)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} !(\.js|\.css|\.png|\.jpg|\.jpeg|\.svg|\.gif|\.ico)$ [NC]
RewriteRule ^.*$ paginas/error404.html [L]